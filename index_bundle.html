<!DOCTYPE html>
<html style="height: 100%;">
    <body>
        <canvas id="scene" style="height: 100%;"></canvas>
        <script type="module" src="js/bundle.js"></script>
        <script>
            async function start() {
                const nodedefs = await fetch("export/nodedefs.json").then(r => r.json());
                const manifest = await fetch("export/mapblocks/manifest.json").then(r => r.json());

                const wv = new ltwv.WebView({
                    target: document.getElementById("scene"),
                    wireframe: false,
                    source: {
                        mapblock: pos => new Promise(resolve => {
                            const pos_str = `(${pos.x},${pos.y},${pos.z})`;
                            if (manifest.mapblocks[pos_str]) {
                                fetch(`export/mapblocks/${pos_str}.json`)
                                .then(r => r.json())
                                .then(mb => {
                                    resolve({
                                        node_mapping: mb.node_mapping,
                                        buffer: ltwv.decompress_base64_gz(mb.mapdata)
                                    })
                                });
                            } else {
                                resolve(null);
                            }
                        }),
                        nodedef: nodename => Promise.resolve(nodedefs[nodename]),
                        media: filename => Promise.resolve(`export/media/${filename}`)
                    }
                });
            }
            start();
        </script>
    </body>
</html>